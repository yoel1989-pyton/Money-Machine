# THE ANOINTMENT PROTOCOL
## Sovereign Architecture for Autonomous Media Systems (v1.0)

---

## ğŸ”’ CORE DOCTRINE

> **The Hunter finds. The Brain decides. The Forge transforms.**
> **You profit.**

---

## ğŸ§¬ SYSTEM ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ANOINTMENT PROTOCOL                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  THE HUNTER (Apify)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ TikTok Scraper â†’ Rawscroll (velocity, volume)         â”‚   â”‚
â”‚  â”‚ â€¢ Instagram Scraper â†’ OnTheDaily (authority, curation)  â”‚   â”‚
â”‚  â”‚ â€¢ Watermark Remover â†’ Clean streams                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                     â”‚
â”‚  THE BRAIN (n8n)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Viral filtering (Shares/Likes > 0.15)                 â”‚   â”‚
â”‚  â”‚ â€¢ Caption rewriting (Creative OS)                       â”‚   â”‚
â”‚  â”‚ â€¢ Routing to Forge + Distribution                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                     â”‚
â”‚  THE FORGE (Railway)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Fingerprint obfuscation (brightness, noise, desync)   â”‚   â”‚
â”‚  â”‚ â€¢ Metadata stripping                                    â”‚   â”‚
â”‚  â”‚ â€¢ H.264/AAC encoding                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                     â”‚
â”‚  DISTRIBUTION (Graph API)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Instagram Reels (Container â†’ Poll â†’ Publish)          â”‚   â”‚
â”‚  â”‚ â€¢ Facebook Video (Parallel, not cross-post)             â”‚   â”‚
â”‚  â”‚ â€¢ First Comment injection (Money Machine)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ FILE STRUCTURE

```
Money-Machine/
â”œâ”€â”€ nixpacks.toml                    # Railway FFmpeg config
â”œâ”€â”€ engines/
â”‚   â””â”€â”€ anointment_forge.py          # FastAPI backend
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ n8n_anointment_protocol.json # Complete n8n workflow
â””â”€â”€ data/apify/
    â”œâ”€â”€ rawscroll_tiktok_config.json
    â”œâ”€â”€ rawscroll_instagram_config.json
    â”œâ”€â”€ onthedaily_instagram_config.json
    â””â”€â”€ watermark_remover_config.json
```

---

## ğŸ”§ THE 422 ERROR FIX

The "422 Unprocessable Entity" error occurs from **double serialization**.

### âŒ WRONG (Double Serialization)
```javascript
// n8n HTTP Request Body
{
  "tags": "{{ JSON.stringify($json.hashtags) }}"
}
```
**Result:** Backend receives a STRING `"[\"#viral\", \"#money\"]"`

### âœ… CORRECT (Direct Expression)
```javascript
// n8n HTTP Request Body
{
  "tags": {{ $json.hashtags }}
}
```
**Result:** Backend receives an ARRAY `["#viral", "#money"]`

### Pydantic Schema (Railway)
```python
class ProcessingRequest(BaseModel):
    video_url: str
    tags: Optional[List[str]] = None  # Expects array, not string
    metadata: Optional[Dict[str, Any]] = None  # Expects object
```

---

## ğŸ¯ THE ANOINTMENT (Fingerprint Obfuscation)

The Forge breaks both hash types to avoid shadowbans:

| Technique | Effect | Detection Method Defeated |
|-----------|--------|---------------------------|
| `brightness=0.01` | +1% brightness | MD5/SHA hash |
| `noise=alls=1` | Random noise | Perceptual hash (pHash) |
| `setpts=PTS/1.01` | 1% time desync | Temporal fingerprint |
| `-map_metadata -1` | Strip XMP tags | Platform metadata flags |
| `aecho=0.8:0.88:6:0.1` | Audio fingerprint | Audio hash |

### FFmpeg Command
```bash
ffmpeg -y -i input.mp4 \
  -vf "eq=brightness=0.01,noise=alls=1:allf=t+u,setpts=PTS/1.01" \
  -af "aecho=0.8:0.88:6:0.1" \
  -map_metadata -1 \
  -fflags +bitexact \
  -c:v libx264 -preset veryfast -crf 26 \
  -c:a aac -b:a 128k \
  output.mp4
```

---

## ğŸ“Š VIRAL TAXONOMY

### Rawscroll (Velocity + Volume)
- **Source:** Hashtags, trending sounds
- **Schedule:** Every 4 hours
- **Filter:** `Viral_Coefficient = Shares / Likes > 0.15`
- **Content:** Ephemeral, trend-based

### OnTheDaily (Authority + Consistency)
- **Source:** Specific creator profiles
- **Schedule:** Daily
- **Filter:** Top 50 posts, skip pinned, recency window
- **Content:** Gold standard, brand-aligned

---

## ğŸš€ DEPLOYMENT

### 1. Deploy Railway Backend
```bash
# In your Railway project
git push railway main
```

The `nixpacks.toml` automatically installs FFmpeg.

### 2. Import n8n Workflow
1. Open n8n
2. Import `workflows/n8n_anointment_protocol.json`
3. Set environment variables:
   - `APIFY_TOKEN`
   - `RAILWAY_BACKEND_URL`
   - `META_ACCESS_TOKEN`
   - `IG_USER_ID`
   - `FB_PAGE_ID`

### 3. Configure Apify Actors
Use the configs in `data/apify/` as templates.

---

## ğŸ’° MONEY MACHINE INTEGRATION

### Affiliate Link Rotation
```javascript
// n8n Code Node
const offers = [
  "https://affiliate.com/offer1",
  "https://affiliate.com/offer2",
  "https://affiliate.com/offer3"
];
const selected = offers[$runIndex % offers.length];
const utm = `?utm_source=instagram&utm_campaign=anointment_${Date.now()}`;
return { link: selected + utm };
```

### First Comment Strategy
```javascript
// After media_publish succeeds
POST /{media-id}/comments
{
  "message": "ğŸ”¥ Link in bio for the full breakdown! ğŸ‘†"
}
```

---

## ğŸ”’ CRITICAL RULES

1. **Never cross-post** - Use parallel native posting
2. **Never pass temp URLs directly** - Download to Railway first
3. **Never stringify arrays in n8n** - Use direct expressions
4. **Never skip watermark removal** - TikTok marks cause shadowbans
5. **Always wait for IG processing** - Poll status before publish

---

## ğŸ FINAL STATE

You now have:
- âœ… Autonomous content acquisition (Apify)
- âœ… Intelligent filtering (Viral Coefficient)
- âœ… Fingerprint obfuscation (Anointment)
- âœ… Parallel distribution (IG + FB)
- âœ… Revenue capture (First Comment + UTM)

**The system is sovereign. Execute.**
